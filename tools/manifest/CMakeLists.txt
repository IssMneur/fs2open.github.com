MACRO(ADD_ARG target)
	LIST(APPEND MANIFEST_FILES $<TARGET_FILE_NAME:${target}>)
ENDMACRO()

SET(MANIFEST_FILE ${EXECUTABLE_OUTPUT_PATH}/manifest.json)
SET(MANIFEST_SCRIPT ${CMAKE_SOURCE_DIR}/tools/manifest/manifest.cmake)

SET(MANIFEST_DEPENDS Freespace2)
ADD_ARG(Freespace2)
IF(FSO_BUILD_FRED2)
	LIST(APPEND MANIFEST_DEPENDS FRED2)
	ADD_ARG(FRED2)
ENDIF(FSO_BUILD_FRED2)
IF(FSO_BUILD_WXFRED2)
	LIST(APPEND MANIFEST_DEPENDS WXFRED2)
	ADD_ARG(WXFRED2)
ENDIF(FSO_BUILD_WXFRED2)

ADD_CUSTOM_TARGET(json_manifest
	COMMAND ${CMAKE_COMMAND} -DCONFIG=$<CONFIG>
	-DMANIFEST_FILE=manifest_${FSO_BINARY_SUFFIX}.json
	-DVERSION_MAJOR=${FSO_VERSION_MAJOR} -DVERSION_MINOR=${FSO_VERSION_MINOR}
	-DVERSION_BUILD=${FSO_VERSION_BUILD}
	-DVERSION_REVISION=${FSO_VERSION_REVISION_STR} -DIS_64BIT=${IS_64BIT}
	-DVERSION_ISA=${FSO_INSTRUCTION_SET}
	"-DMANIFEST_FILES=${MANIFEST_FILES}"
	-P ${MANIFEST_SCRIPT}
	DEPENDS ${MANIFEST_DEPENDS}
	WORKING_DIRECTORY ${CMAKE_BINARY_DIR}/${CMAKE_CFG_INTDIR}
	COMMENT "Generating json manifest")

SET_SOURCE_FILES_PROPERTIES(
	${MANIFEST_VERSION_INFO}
	PROPERTIES HEADER_FILE_ONLY true)

SET_TARGET_PROPERTIES(json_manifest
	PROPERTIES
		FOLDER "Tools"
)
